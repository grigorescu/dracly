<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>A Scanner DRACly</title>
<meta name="author" content="Vlad Grigorescu"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../docs/js/reveal.js-4.1.1/dist/reveal.css"/>

<link rel="stylesheet" href="../docs/js/reveal.js-4.1.1/dist/theme/tomorrow_night.css" id="theme"/>

<link rel="stylesheet" href="css/asciinema-player.css"/>

<link rel="stylesheet" href="css/custom.css"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1>A Scanner DRACly<h1><h3>A PenTest Story</h3><h4>Vlad Grigorescu<br>2021-06-10</h4><img style="position:absolute; top:250px; left:700px; width:150px; height:150px; transform: rotate(30deg)" src="img/cppc.png">
</section>
<section>
<section id="slide-orgca6056c">
<h2 id="orgca6056c">About Me</h2>
<ul>
<li>Security Engineer @ UIUC, CMU, NCSA, ESnet</li>
<li>Core Zeek Developer</li>
<li>Consultant, focused on PenTesting</li>
<li>A few CVEs, a few CTF wins</li>

</ul>

<aside class="notes">
<ul>
<li>Focused on tool development and defense</li>
<li>A chance to flex the offensive skillset</li>
<li>SANS CTF</li>

</ul>

</aside>
</section>
</section>
<section>
<section id="slide-org5bdf3ba">
<h2 id="org5bdf3ba">What this Talk Is</h2>
<ul>
<li>The story of a PenTest</li>
<li>What defenses were in place</li>
<li>How they failed (and why it matters)</li>
<li>How they can be improved</li>
<li>How you can build up red-team expertise</li>

</ul>

<aside class="notes">
<ul>
<li>Aashish and Jay talks at SPC, focused on defense</li>
<li>Attacker's point of view</li>

</ul>

</aside>
</section>
<section id="slide-orgf1957bf">
<h3 id="orgf1957bf">What this Talk is NOT</h3>
<ul>
<li>A vendor pitch</li>
<li>A reflection of anyone else's views</li>
<li>Revolutionary</li>

</ul>
</section>
</section>
<section>
<section id="slide-org3155006">
<h2 id="org3155006">PenTest Overview: Mission</h2>
<ul>
<li>Collaboration with a hospital on medical research</li>
<li>Scope was expanded with the school's COVID response</li>
<li><strong>Can an attacker access PHI?</strong></li>

</ul>
</section>
<section id="slide-orgdd8cb8e">
<h3 id="orgdd8cb8e">Step 1: Work with the CSO to determine scope</h3>
<ul>
<li>Everything*</li>
<li>No physical access to the PHI servers</li>
<li>Any blowback better be worth it</li>

</ul>
</section>
<section id="slide-org053cb95">
<h3 id="org053cb95">Logistics</h3>
<ul>
<li>Client provided list of subnets and access to some Slack channels</li>
<li>I told the CSO when the test began and ended</li>
<li>External test: No access provided</li>
<li>Internal test: Virtual machine with no special access provided</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgbd7a97d">
<h2 id="orgbd7a97d">Open-Source Intelligence</h2>
<ul>
<li>Reverse DNS (<code>nmap -sL</code>)</li>
<li>Certificate Transparency Logs</li>

</ul>
</section>
<section id="slide-org2f915ce">
<h3 id="org2f915ce">OSINT: EDU</h3>
<ul>
<li>InCommon Federation</li>
<li><p>
eduroam
</p>

<div id="org6c6ca3a" class="figure">
<p><img src="./img/eduroam.png" alt="eduroam.png" width="500px">
</p>
</div></li>

</ul>
</section>
<section id="slide-org08b2b43">
<h3 id="org08b2b43">OSINT: EDU</h3>
<ul>
<li><p>
Mailing lists
</p>
<blockquote>
<p>
We monitor two full /16, 3 /24, and 2 partial /16, in front of any local FW devices.
</p>

<p>
&#x2026;
</p>

<p>
I switched to the bro-simple-scan package.
</p>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-org18319bf">
<h2 id="org18319bf">Scanning</h2>
<ul>
<li><p>
bro-simple-scan
</p>

<div id="org88fe485" class="figure">
<p><img src="./img/simple_scan_bug.png" alt="simple_scan_bug.png" width="500px">
</p>
</div></li>

</ul>
</section>
<section id="slide-org74dc09c">
<h3 id="org74dc09c">bro-simple-scan</h3>
<div class="org-src-container">

<pre class="src src-ruby">    event connection_attempt(<span style="color: #81a2be;">c:</span> connection)
    {
-   <span style="color: #b5bd68;">if</span> ( c<span style="color: #f0c674;">$history</span> == <span style="color: #8abeb7;">"S"</span> )
+   <span style="color: #b5bd68;">if</span> ( c<span style="color: #f0c674;">$history</span> == <span style="color: #8abeb7;">"S"</span> || c<span style="color: #f0c674;">$history</span> == <span style="color: #8abeb7;">"SW"</span>)
    add_scan(c<span style="color: #f0c674;">$id</span>);
    }
</pre>
</div>
</section>
<section id="slide-orgc87d99d">
<h3 id="orgc87d99d">masscan</h3>
<div class="org-src-container">

<pre class="src src-c++">     <span style="color: #b5bd68;">static</span> <span style="color: #81a2be;">unsigned</span> <span style="color: #81a2be;">char</span> <span style="color: #f0c674;">default_tcp_template</span>[] =
     <span style="color: #969896; font-style: italic;">// </span><span style="color: #969896; font-style: italic;">...</span>
-         <span style="color: #8abeb7;">"\x04\x0"</span>     <span style="color: #969896; font-style: italic;">/* </span><span style="color: #969896; font-style: italic;">window fixed to 1024</span><span style="color: #969896; font-style: italic;"> */</span>
+         <span style="color: #8abeb7;">"\x00\x0"</span>     <span style="color: #969896; font-style: italic;">/* </span><span style="color: #969896; font-style: italic;">0-sized window</span><span style="color: #969896; font-style: italic;"> */</span>
</pre>
</div>
</section>
<section id="slide-orgf372e7b">
<h3 id="orgf372e7b">Update Zeek Packages</h3>

<div id="org69a150d" class="figure">
<p><img src="./img/github_watch.png" alt="github_watch.png" width="500px">
</p>
</div>
</section>
<section id="slide-org3f227cf">
<h3 id="org3f227cf">Zeek ssh/main.zeek</h3>
<div class="org-src-container">

<pre class="src src-ruby">event ssh_auth_attempted(<span style="color: #81a2be;">c:</span> connection, <span style="color: #81a2be;">authenticated:</span> bool) {

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">...</span>

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">We can't accurately tell for compressed streams</span>

<span style="color: #b5bd68;">if</span> ( c<span style="color: #f0c674;">$ssh</span>?<span style="color: #f0c674;">$compression_alg</span> &amp;&amp; \
     ( c<span style="color: #f0c674;">$ssh$compression_alg</span> <span style="color: #b5bd68;">in</span> compression_algorithms ) )
   <span style="color: #b5bd68;">return</span>;
</pre>
</div>
</section>
</section>
<section>
<section id="slide-orgf2c0eeb">
<h2 id="orgf2c0eeb">Scanning Demo</h2>
<asciinema-player src="casts/masscan_demo.cast" preload="yes" poster="npt:0:03" theme="tomorrow-night-bright"></asciinema-player>
</section>
</section>
<section>
<section id="slide-orge4c5b3b">
<h2 id="orge4c5b3b">Next Steps</h2>
<ul>
<li>Look at TLS certificates</li>
<li>Identify:
<ul>
<li>applications,</li>
<li>versions,</li>
<li>vulnerabilities</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org0ceba4b">
<h2 id="org0ceba4b">CVE-2018-1207</h2>

<div id="orgaffd5ac" class="figure">
<p><img src="./img/drac_cve.png" alt="drac_cve.png" width="800px">
</p>
</div>
</section>
<section id="slide-orgb79edfc">
<h3 id="orgb79edfc"></h3>

<div id="org90d6f16" class="figure">
<p><img src="./img/drac_results.png" alt="drac_results.png" width="580px">
</p>
</div>

</section>
</section>
<section>
<section id="slide-org28b4973">
<h2 id="org28b4973">Trash</h2>
<p>
#####+REVEAL<sub>INIT</sub><sub>SCRIPT</sub>: parallaxBackgroundImage: "./background.jpg", parallaxBackgroundSize: "6211px 1686px"
</p>
</section>
</section>
</div>
</div>
<script src="../docs/js/reveal.js-4.1.1/dist/reveal.js"></script>
<script src="../docs/js/reveal.js-4.1.1/plugin/markdown/markdown.js"></script>
<script src="../docs/js/reveal.js-4.1.1/plugin/notes/notes.js"></script>
<script src="../docs/js/reveal.js-4.1.1/plugin/search/search.js"></script>
<script src="../docs/js/reveal.js-4.1.1/plugin/zoom/zoom.js"></script>
<script src="js/asciinema-player.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,

transition: 'cube',
transitionSpeed: 'default',

// Plugins with reveal.js 4.x
plugins: [ RevealMarkdown, RevealNotes, RevealSearch, RevealZoom ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
