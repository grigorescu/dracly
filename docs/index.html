<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>A Scanner DRACly</title>
<meta name="author" content="Vlad Grigorescu"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="js/reveal.js-4.1.1/dist/reveal.css"/>

<link rel="stylesheet" href="js/reveal.js-4.1.1/dist/theme/tomorrow_night.css" id="theme"/>

<link rel="stylesheet" href="css/asciinema-player.css"/>

<link rel="stylesheet" href="css/custom.css"/>
<link rel="stylesheet" href="js/reveal.js-4.1.1/plugin/highlight/zenburn.css"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1>A Scanner DRACly<h1><h3>A PenTest Story</h3><h4>Vlad Grigorescu<br>2021-06-10</h4><img style="position:absolute; top:250px; left:700px; width:150px; height:150px; transform: rotate(30deg)" src="img/cppc.png">
</section>
<section>
<section id="slide-org82c7717">
<h2 id="org82c7717">About Me</h2>
<ul>
<li>Security Engineer @ UIUC, CMU, NCSA, ESnet</li>
<li>Core Zeek Developer</li>
<li>Consultant, focused on PenTesting</li>
<li>A few CVEs, a few CTF wins</li>

</ul>

<aside class="notes">
<ul>
<li>Focused on tool development and defense</li>
<li>A chance to flex the offensive skillset</li>
<li>SANS CTF</li>

</ul>

</aside>
</section>
</section>
<section>
<section id="slide-org1fc3feb">
<h2 id="org1fc3feb">What this Talk Is</h2>
<ul>
<li>The story of a PenTest</li>
<li>What defenses were in place</li>
<li>How they failed (and why it matters)</li>
<li>How they can be improved</li>
<li>How you can build up red-team expertise</li>

</ul>

<aside class="notes">
<ul>
<li>Aashish and Jay talks at SPC, focused on defense</li>
<li>Attacker's point of view</li>

</ul>

</aside>
</section>
<section id="slide-org5ac591d">
<h3 id="org5ac591d">What this Talk is NOT</h3>
<ul>
<li>A vendor pitch</li>
<li>A reflection of anyone else's views</li>
<li>Revolutionary</li>

</ul>
</section>
</section>
<section>
<section id="slide-org056e495">
<h2 id="org056e495">PenTest Overview: Mission</h2>
<ul>
<li>Collaboration with a hospital on medical research</li>
<li>Scope was expanded with the school's COVID response</li>
<li><strong>Can an attacker access PHI?</strong></li>

</ul>
</section>
<section id="slide-org22e45d9">
<h3 id="org22e45d9">Logistics</h3>
<ul>
<li>Determine scope</li>
<li>Client provided list of subnets and access to some Slack channels</li>
<li>I told the CSO when the test began and ended</li>
<li>External test: No access provided</li>
<li>Internal test: Virtual machine with no special access provided</li>

</ul>
</section>
</section>
<section>
<section id="slide-org297af60">
<h2 id="org297af60">Open-Source Intelligence</h2>
<ul>
<li>Reverse DNS (<code>nmap -sL</code>)</li>
<li>Certificate Transparency Logs</li>

</ul>
</section>
<section id="slide-orgb7345df">
<h3 id="orgb7345df">OSINT: EDU</h3>
<ul>
<li>InCommon Federation</li>
<li><p>
eduroam
</p>

<div id="org1b8a510" class="figure">
<p><img src="./img/eduroam.png" alt="eduroam.png" width="500px">
</p>
</div></li>

</ul>
</section>
<section id="slide-orga60711f">
<h3 id="orga60711f">OSINT: EDU</h3>
<ul>
<li><p>
Mailing lists
</p>
<blockquote>
<p>
We monitor two full /16, 3 /24, and 2 partial /16, in front of any local FW devices.
</p>

<p>
&#x2026;
</p>

<p>
I switched to the bro-simple-scan package.
</p>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-org4d6db5e">
<h2 id="org4d6db5e">Scanning</h2>
<ul>
<li><p>
bro-simple-scan
</p>

<div id="orgc0de5aa" class="figure">
<p><img src="./img/simple_scan_bug.png" alt="simple_scan_bug.png" width="500px">
</p>
</div></li>

</ul>
</section>
<section id="slide-org2594079">
<h3 id="org2594079">bro-simple-scan</h3>
<div class="org-src-container">

<pre><code class="ruby" >    event connection_attempt(c: connection)
    {
-   if ( c$history == "S" )
+   if ( c$history == "S" || c$history == "SW")
	add_scan(c$id);
    }
</code></pre>
</div>
</section>
<section id="slide-org8ab473f">
<h3 id="org8ab473f">masscan</h3>
<div class="org-src-container">

<pre><code class="c++" >     static unsigned char default_tcp_template[] =
     // ...
-         "\x04\x0"     /* window fixed to 1024 */
+         "\x00\x0"     /* 0-sized window */
</code></pre>
</div>
</section>
<section id="slide-orgcbdd1bd">
<h3 id="orgcbdd1bd">Update Zeek Packages</h3>

<div id="orgf6791ca" class="figure">
<p><img src="./img/github_watch.png" alt="github_watch.png" width="500px">
</p>
</div>
</section>
<section id="slide-org77b3bdb">
<h3 id="org77b3bdb">Zeek ssh/main.zeek</h3>
<div class="org-src-container">

<pre><code class="ruby" >event ssh_auth_attempted(c: connection, authenticated: bool) {

# ...

# We can't accurately tell for compressed streams

if ( c$ssh?$compression_alg &amp;&amp; \
     ( c$ssh$compression_alg in compression_algorithms ) )
   return;
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org1d4677a">
<h2 id="org1d4677a">Scanning Demo</h2>
<asciinema-player src="casts/masscan_demo.cast" preload="yes" poster="npt:0:03" theme="tomorrow-night-bright" rows=15></asciinema-player>
</section>
</section>
<section>
<section id="slide-org0f323fd">
<h2 id="org0f323fd">Next Steps</h2>
<ul>
<li>Look at TLS certificates</li>
<li>Identify:
<ul>
<li>applications,</li>
<li>versions,</li>
<li>vulnerabilities</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org7f56a39">
<h2 id="org7f56a39">CVE-2018-1207</h2>

<div id="org029ebed" class="figure">
<p><img src="./img/drac_cve.png" alt="drac_cve.png" width="800px">
</p>
</div>
</section>
<section id="slide-org968383a">
<h3 id="org968383a">RCE Demo</h3>
<asciinema-player src="casts/rce_demo.cast" preload="yes" poster="npt:0:03" theme="tomorrow-night-bright" rows=45></asciinema-player>
</section>
<section id="slide-org7b8f633">
<h3 id="org7b8f633">CVE Results</h3>

<div id="org035d70e" class="figure">
<p><img src="./img/drac_results.png" alt="drac_results.png" width="580px">
</p>
</div>
</section>
</section>
</div>
</div>
<script src="js/reveal.js-4.1.1/dist/reveal.js"></script>
<script src="js/reveal.js-4.1.1/plugin/highlight/highlight.js"></script>
<script src="js/reveal.js-4.1.1/plugin/search/search.js"></script>
<script src="js/asciinema-player.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,

transition: 'cube',
transitionSpeed: 'default',

// Plugins with reveal.js 4.x
plugins: [ RevealHighlight, RevealSearch ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
